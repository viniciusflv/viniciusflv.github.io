---
import Header from '@/components/Header.astro';

import { getLanguageFromURL } from '../util';

import SEO from './SEO.astro';

// import ogScraper from 'open-graph-scraper';
// ogScraper({
//   url: 'https://www.swyx.io/learn-in-public/',
// })
//   .then(({ result }) => console.log(result))
//   .catch(console.error);

const lang = getLanguageFromURL(Astro.url.pathname);
const knownLanguages = ['en', 'pt-BR'];
const formatAlternateHref = (hreflang: string) =>
  new URL(
    Astro.url.pathname.replace(/^\/(.*)\//g, `/${hreflang}/`),
    Astro.site,
  );
---

<html lang={lang}>
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover"
      name="viewport"
    />
    <meta content={lang} property="og:locale" />
    {
      knownLanguages.map((hreflang) => (
        <link
          rel="alternate"
          href={formatAlternateHref(hreflang)}
          hreflang={hreflang}
        />
      ))
    }
    <SEO lang={lang} {...Astro.props} />
  </head>

  <body class="body">
    <section class:list={['section']}>
      <Header lang={lang} knownLanguages={knownLanguages} {...Astro.props} />
      <slot />
    </section>
    <style is:global>
      * {
        /* outline: 0.01px solid red; */
        @media (prefers-reduce-motion: reduce) {
          animation-duration: 0ms !important;
          scroll-behavior: initial;
        }

        scroll-behavior: smooth;

        @media (orientation: landscape) {
          ::-webkit-scrollbar {
            @apply dark:w-3;
          }
          ::-webkit-scrollbar-track {
            @apply dark:bg-[color:#0005] rounded-full;
          }
          ::-webkit-scrollbar-thumb {
            @apply rounded-full dark:bg-dark-green;
          }
        }
      }

      .body {
        @apply font-paragraph text-gray-800 dark:text-gray-100;

        @apply flex w-full
        min-h-screen
        bg-white
        dark:bg-dark-darkest;

        .section {
          @apply flex
          flex-col
          w-full;

          h1 {
            @apply text-2xl
            md:text-3xl
            lg:text-5xl
            font-bold
            tracking-wider
            pb-4;

            @apply text-transparent
            bg-clip-text
            bg-gradient-to-r
            from-dark-comment
            to-dark-purple
            dark:from-dark-cyan 
            dark:to-dark-green;
          }

          h2 {
            @apply text-xl md:text-2xl opacity-80;
          }

          h3 {
            @apply text-xl md:text-2xl font-bold;
          }

          h4 {
            @apply text-lg font-bold;
          }

          h5 {
            @apply font-bold;
          }

          strong {
            @apply text-black dark:text-dark-green;
          }

          p,
          li {
            @apply text-sm md:text-base text-gray-600 dark:text-gray-300;
          }

          article {
            h1 {
              @apply max-w-full leading-snug;
            }

            ul {
              @apply pl-8;
              li {
                @apply list-disc;
              }
            }

            ol {
              @apply pl-8;
              li {
                @apply list-decimal;
              }
            }

            a {
              @apply underline
              text-blue-400
              dark:text-dark-cyan;
            }

            blockquote {
              @apply italic
              p-4
              border-l-4
              border-l-dark-green
              bg-black
              bg-opacity-5;
            }
          }

          hr {
            @apply border-dark-comment;
          }

          .shiki.dracula {
            @apply relative max-w-full rounded
            shadow-2xl
            border
            border-gray-200
            dark:border-dark-currentLine;

            .language-id {
              @apply absolute
              left-8
              top-[-1rem]
              px-1
              rounded
              text-dark-darkest
              font-bold
              bg-dark-green
              shadow-xl;
            }

            .code-container {
              @apply p-8
              overflow-auto;

              &::-webkit-scrollbar {
                @apply w-3;
              }
              &::-webkit-scrollbar-track {
                @apply bg-black;
              }
              &::-webkit-scrollbar-thumb {
                @apply rounded-full bg-dark-green;
              }
            }

            @media (prefers-color-scheme: light) {
              @apply !bg-white;

              & .language-id,
              .code-container {
                @apply invert;
              }
            }
          }
        }
      }
    </style>
  </body>
</html>
