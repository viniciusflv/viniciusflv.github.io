---
import Button from '../../components/Button.astro';
import Hero from '../../components/Hero.astro';
import Layout from '../../layouts/Layout.astro';

import fs from 'fs';

import { hero } from '../../assets/svg';

const files = (await Astro.glob('./posts/**/*.mdx')).filter(
  ({ frontmatter }) => frontmatter.categories,
);

const categories = files.map(({ frontmatter, url }) => ({
  label: frontmatter.categories,
  value: url,
}));

const posts = files.sort((a, b) => {
  const statsA = fs.statSync(a.file);
  const statsB = fs.statSync(b.file);

  return statsB.mtime.getTime() - statsA.mtime.getTime();
});

const meta = {
  title: 'Welcome to my personal website!',
  keywords: 'programming,front-end,javascript,typescript,react,technologies',
  description: `
    Here I talk about my experiences and technologies,
    that I'm passionate about.
  `,
};
---

<Layout
  title={meta.title}
  description={meta.description}
  keywords={meta.keywords}
>
  <Hero clip={hero}>
    <h1>{meta.title}</h1>
    <h2>
      {meta.description}
    </h2>
    <div class="flex flex-wrap gap-4 w-full">
      <Button href="posts">My Posts</Button>
      <Button href="about">About Me</Button>
    </div>
  </Hero>
  <div class="flex container p-8 mx-auto">
    <main class="flex flex-col grow gap-8">
      <h3 class="text-dark-comment">Last Published Posts</h3>
      {
        posts.map(({ frontmatter, url }) => (
          <div>
            <h4>{frontmatter.title}</h4>
            <p class="text-gray-400">{frontmatter.description}</p>
            <a href={url} class="text-dark-comment underline">
              Read More
            </a>
          </div>
        ))
      }
    </main>
    <aside class="flex flex-col gap-8">
      <h3 class="text-dark-comment">By Category</h3>
      <div class="flex items-start self-start flex-wrap gap-4 w-52 text-xs">
        {
          categories.map(({ label, value }) => (
            <a
              href={value}
              class="
                flex
                justify-center
                rounded-full
                py-2
                px-4
                text-white
                bg-dark-comment
              "
            >
              {label}
            </a>
          ))
        }
      </div>
    </aside>
  </div>
</Layout>
